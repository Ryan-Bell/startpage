<!DOCTYPE HTML>
<head>
  <title>Startpage</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="container">
    <div id="header">
      <h3 style="display: inline">
        <span class="red"> ~ </span><span class="green"> weather</span>
      </h3>
      <br/>
      <pre class="gray" id="weatherdiv"></pre>
    </div>
    <div id="links">
      <div class="linksbox">
        <h3><span class="red"> ~ [General]</span><span class="blue">:</span> ls</h3>
        <a class="cyan" target="blank" href="http://amazon.com">Amazon</a>
        <a class="cyan"  target="blank" href="https://gmail.com">Gmail</a>
        <a class="cyan" target="blank" href="https://youtube.com">Youtube</a>
        <a class="cyan" target="blank" href="https://github.com/">Github</a>
      </div>

      <div class="linksbox">
        <h3><span class="red"> ~ [Reddit]</span><span class="blue">:</span> ls</h3>
        <a class="cyan" target="blank" href="https://www.reddit.com">Front Page</a>
        <a class="cyan" target="blank" href="https://www.reddit.com/r/plex/">/r/plex</a>
        <a class="cyan" target="blank" href="https://www.reddit.com/r/unixporn/">/r/unixporn</a>
        <a class="cyan" target="blank" href="https://www.reddit.com/r/askreddit/">/r/askreddit</a>
      </div>

      <div class="linksbox">
        <h3><span class="red"> ~ [School]</span><span class="blue">:</span> ls</h3>
        <a class="cyan"  target="blank" href="https://mycourses.rit.edu">MyCourses</a>
        <a class="cyan" target="blank" href="https://people.rit.edu/arwigm/430/">430</a>
        <a class="cyan" target="blank" href="https://tigercenter.rit.edu">TigerCenter</a>
        <a class="cyan" target="blank" href="https://eservices.rit.edu">eservices</a>
      </div>
    </div>
    <div id="header">
      <h3 style="display: inline">
        <span class="red"> ~ </span><span class="green"> uptime</span>
      </h3>
      <br/>
      <h3 style="display: inline">
        <span class="gray"></span> <span class="gray" id="uptimeSpan"></span>
      </h3>
    </div>
    <div id="header">
      <input type="text" id="listInput" placeholder="+ List item">
      <span onclick="addListItem()" class="addBtn">Add</span>
      <span onclick="removeListItem()" class="removeBtn">Remove</span>
      <ul id="tasklist"></ul>
    </div>
  </div>
  <script>
    function loadUptime() {
      let xmlhttp = new XMLHttpRequest();

      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4
          if (xmlhttp.status == 200) {
            document.getElementById("uptimeSpan").innerHTML = xmlhttp.responseText;
          }
          else if (xmlhttp.status == 400) {
            alert('There was an error 400');
          }
          else {
            alert('something else other than 200 was returned');
          }
        }
      };

      xmlhttp.open("GET", "/uptime", true);
      xmlhttp.send();
    };

    loadUptime();

    function loadWeather() {
      let xmlhttp = new XMLHttpRequest();

      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4
          if (xmlhttp.status == 200) {
            document.getElementById("weatherdiv").innerHTML = xmlhttp.responseText;
          }
          else if (xmlhttp.status == 400) {
            alert('There was an error 400');
            document.getElementById("weatherdiv").innerHTML = xmlhttp.responseText;
          }
          else {
            alert('something else other than 200 was returned');
            document.getElementById("weatherdiv").innerHTML = xmlhttp.responseText;
          }
        }
      };

      xmlhttp.open("GET", "/weather", true);
      xmlhttp.send();
    }

    loadWeather();

    function loadTasks() {
      let xmlhttp = new XMLHttpRequest();

      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4
          if (xmlhttp.status == 200) {
            xmlhttp.responseText.split('\n').forEach(function(taskItem){
              if (!taskItem) return;
              let taskDomElement = document.createElement('li');
              let textElement = document.createTextNode(taskItem.split('- ')[1]);
              taskDomElement.appendChild(textElement);
              document.getElementById("tasklist").appendChild(taskDomElement);
            });
          }
          else if (xmlhttp.status == 400) {
            alert('There was an error 400');
            //document.getElementById("weatherdiv").innerHTML = xmlhttp.responseText;
          }
          else {
            alert('something else other than 200 was returned');
            //document.getElementById("weatherdiv").innerHTML = xmlhttp.responseText;
          }
        }
      };

      xmlhttp.open("GET", "/tasks", true);
      xmlhttp.send();
    }

    loadTasks();

    function addListItem(){
      var li = document.createElement("li");
      var inputValue = document.getElementById("listInput").value;
      var t = document.createTextNode(inputValue);
      li.appendChild(t);
      if (inputValue === '') {
        alert("Cannot create an empty task");
      } else {
        //TODO send to server and rerequest the list instead
        document.getElementById("tasklist").appendChild(li);
      }
      document.getElementById("listInput").value = "";

      var span = document.createElement("SPAN");
      var txt = document.createTextNode("\u00D7");
      span.className = "close";
      span.appendChild(txt);
      li.appendChild(span);
    };

  </script>
</body>
</html>
